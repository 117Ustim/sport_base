# üîß –ù–ê–°–¢–†–û–ô–ö–ê FIRESTORE –ò–ù–î–ï–ö–°–û–í

**–î–∞—Ç–∞:** 06.02.2026  
**–ü—Ä–æ–µ–∫—Ç:** sport_base  

---

## ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –≠—Ç–∞–ø–∞ 5 (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `orderBy` + `limit`) —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å composite index –≤ Firestore.

---

## üìã –ò–ù–î–ï–ö–° –î–õ–Ø ASSIGNEDWORKOUTS

### –û—à–∏–±–∫–∞:
```
FirebaseError: The query requires an index. You can create it here: https://console.firebase.google.com/...
```

### –ü—Ä–∏—á–∏–Ω–∞:
–ó–∞–ø—Ä–æ—Å –≤ `assignedWorkoutsService.getAssignedWorkoutsByClientId()`:
```javascript
const q = query(
  assignmentsRef, 
  where('clientId', '==', clientId),
  orderBy('assignedAt', 'desc'), // ‚úÖ –ù–æ–≤–æ–µ - —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–¥–µ–∫—Å
  limit(limitCount)
);
```

Firestore —Ç—Ä–µ–±—É–µ—Ç composite index –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å `where` + `orderBy` + `limit`.

---

## üõ†Ô∏è –ö–ê–ö –ò–°–ü–†–ê–í–ò–¢–¨

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞**
   - –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
   - –ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫—É —Å —Ç–µ–∫—Å—Ç–æ–º "The query requires an index"
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ –æ—à–∏–±–∫–∏

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ**
   - –í—ã –ø–æ–ø–∞–¥–µ—Ç–µ –≤ Firebase Console
   - –ò–Ω–¥–µ–∫—Å —É–∂–µ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

3. **–ù–∞–∂–º–∏—Ç–µ "Create Index"**
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ–∫–∞ –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–µ—Ç—Å—è
   - –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏—Ç—Å—è —Å "Building" –Ω–∞ "Enabled"

4. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   - –û—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Firebase Console**
   - https://console.firebase.google.com/
   - –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `calendar-new-599f8`

2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Firestore Database**
   - –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é ‚Üí Firestore Database
   - –í–∫–ª–∞–¥–∫–∞ "Indexes"

3. **–°–æ–∑–¥–∞–π—Ç–µ Composite Index**
   - –ù–∞–∂–º–∏—Ç–µ "Create Index"
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
     - **Collection ID:** `assignedWorkouts`
     - **Fields to index:**
       1. `clientId` - Ascending
       2. `assignedAt` - Descending
     - **Query scope:** Collection

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ**
   - –ù–∞–∂–º–∏—Ç–µ "Create"
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ–∫–∞ –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–µ—Ç—Å—è

5. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

---

## üìä –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ù–î–ï–ö–°–ê

```json
{
  "indexes": [
    {
      "collectionGroup": "assignedWorkouts",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "clientId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "assignedAt",
          "order": "DESCENDING"
        }
      ]
    }
  ]
}
```

---

## üîç –ü–†–û–í–ï–†–ö–ê

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞:

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
2. **–û—Ç–∫—Ä–æ–π—Ç–µ WorkoutDetails**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞**
   - –û—à–∏–±–∫–∞ "The query requires an index" –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
   - –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ò–ù–î–ï–ö–°–´ (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ—è–≤—è—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π:

### assignedWorkouts (userId)
```json
{
  "collectionGroup": "assignedWorkouts",
  "queryScope": "COLLECTION",
  "fields": [
    {
      "fieldPath": "userId",
      "order": "ASCENDING"
    },
    {
      "fieldPath": "assignedAt",
      "order": "DESCENDING"
    }
  ]
}
```

### workouts (clientId)
```json
{
  "collectionGroup": "workouts",
  "queryScope": "COLLECTION",
  "fields": [
    {
      "fieldPath": "clientId",
      "order": "ASCENDING"
    },
    {
      "fieldPath": "createdAt",
      "order": "DESCENDING"
    }
  ]
}
```

---

## ‚ùì –ü–û–ß–ï–ú–£ –≠–¢–û –ù–£–ñ–ù–û?

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```javascript
// ‚ùå –ó–∞–≥—Ä—É–∂–∞–ª–∏ –í–°–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
const q = query(assignmentsRef, where('clientId', '==', clientId));
const snapshot = await getDocs(q);

// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–º–µ–¥–ª–µ–Ω–Ω–æ)
assignments.sort((a, b) => b.assignedAt.localeCompare(a.assignedAt));
```

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```javascript
// ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
const q = query(
  assignmentsRef, 
  where('clientId', '==', clientId),
  orderBy('assignedAt', 'desc'), // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–±—ã—Å—Ç—Ä–æ)
  limit(10) // –¢–æ–ª—å–∫–æ 10 –∑–∞–ø–∏—Å–µ–π
);
const snapshot = await getDocs(q);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- -80% Firebase reads (–±—ã–ª–æ 50-100, —Å—Ç–∞–ª–æ 10)
- –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- –ú–µ–Ω—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞

**–ù–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:** Composite index –¥–ª—è —Ä–∞–±–æ—Ç—ã `where` + `orderBy`

---

## üéØ –ò–¢–û–ì

1. ‚úÖ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ "Create Index"
3. ‚úÖ –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–≠—Ç–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è!** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –æ—à–∏–±–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 06.02.2026  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
